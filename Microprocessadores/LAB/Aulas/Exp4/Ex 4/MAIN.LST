  Thu Apr 18 2013 16:43                                                                                                  Page    1







               2500 A.D. 8051 Macro Assembler  -  Version 4.01a
               ------------------------------------------------

                       Input  Filename : main.asm
                       Output Filename : main.obj


    1          0000            	SearchOK                reg             20h.0
    2          000E            	Counter                 equ             0Eh
    3                          	
    4   0000                   	         .chip 8051
    5                          	
    6   0000   12 00 2B        	inicio:  call  READ_KEY
    7   0003   30 00 FA        	         jnb   SearchOK,inicio
    8   0006   E5 F0           	         mov   A,B
    9                          	;         mov
   10   0008   12 00 13        	         call  Convert
   11   000B   D2 B1           	         setb  p3.1
   12   000D   C2 B0           	         clr   p3.0
   13   000F   F5 80           	         mov   P0,A
   14   0011   80 ED           	         sjmp  inicio
   15                          	;---------------------------------------------------------------------
   16   0013   54 0F           	Convert: anl   A,#0Fh
   17   0015   90 00 1B        	         mov   dptr,#table
   18   0018   93              	         movc  A,@A+dptr
   19   0019   F4              	         cpl   A
   20   001A   22              	         ret
   21                          	;---------------------------------------------------------------------
   22                          	;ascii:   db    41h,39h,38h,37h
   23                          	;         db    42h,36h,35h,34h
   24                          	;         db    43h,33h,32h,31h
   25                          	;         db    44h,45h,30h,46h
   26                          	;---------------------------------------------------------------------
   27                          	table:   ;     .gfedcba
   28   001B   3F              	         db    00111111b   ;0
   29   001C   06              	         db    00000110b   ;1
   30   001D   5B              	         db    01011011b   ;2
   31   001E   4F              	         db    01001111b   ;3
   32   001F   66              	         db    01100110b   ;4
   33   0020   6D              	         db    01101101b   ;5
   34   0021   7D              	         db    01111101b   ;6
   35   0022   07              	         db    00000111b   ;7
   36   0023   7F              	         db    01111111b   ;8
   37   0024   67              	         db    01100111b   ;9
   38   0025   77              	         db    01110111b   ;A
   39   0026   7C              	         db    01111100b   ;b
   40   0027   39              	         db    00111001b   ;C
   41   0028   5E              	         db    01011110b   ;d
   42   0029   79              	         db    01111001b   ;E
   43   002A   71              	         db    01110001b   ;F
   44                          	
   45   002B                   	         include Teclado.asm
   46   002B   C2 00           	READ_KEY: clr   SearchOK
   47   002D   75 90 FE        	          mov   P1,#FEh                 ;alimenta a primeira linha do teclado
  Thu Apr 18 2013 16:43                                                                                                  Page    2




   48   0030   E5 90           	          mov   A,P1                    ;Le teclado
   49   0032   B4 FE 19        	          cjne  A,#FEh,leu              ;Compara o valor lido com FEh:
   50   0035   75 90 FD        	          mov   P1,#FDh                                  ;Se for igual nenhuma tecla da primeira lin
                                ha foi pressionada continua executando
   51   0038   E5 90           	          mov   A,P1                                     ;Se for diferente uma tecla da primeira lin
                                ha foi pressionado, vai para o subprograma LEU
   52   003A   B4 FD 11        	          cjne  A,#FDh,leu
   53   003D   75 90 FB        	          mov   P1,#FBh
   54   0040   E5 90           	          mov   A,P1
   55   0042   B4 FB 09        	          cjne  A,#FBh,leu
   56   0045   75 90 F7        	          mov   P1,#F7h
   57   0048   E5 90           	          mov   A,P1
   58   004A   B4 F7 01        	          cjne  A,#F7h,leu
   59   004D   22              	          ret
   60                          	;-------------------------------------------------------------------------------------
   61   004E   F5 F0           	leu:                       mov   B,A
   62   0050   75 0E 00        	                           mov   Counter,#0
   63   0053   90 00 79        	                           mov   dptr,#codigo_tec
   64   0056   E4              	procura_codigo_lido:       clr   A
   65   0057   93              	                           movc  A,@A+dptr
   66   0058   60 10           	                           jz    sai
   67   005A   B5 F0 0E        	                           cjne  A,B,incr_ponteiros
   68   005D   90 00 8A        	procura_funcao_tecla:      mov   dptr,#funcoes_tec
   69   0060   E5 0E           	                           mov   A,Counter
   70   0062   93              	                           movc  A,@A+dptr
   71   0063   D2 00           	                           setb  SearchOK
   72   0065   F5 F0           	                           mov   B,A
   73   0067   12 00 70        	                           call  solta_tecla
   74   006A   22              	sai:                       ret
   75                          	;-------------------------------------------------------------------------------------
   76   006B   A3              	incr_ponteiros:            inc   dptr
   77   006C   05 0E           	                           inc   Counter
   78   006E   80 E6           	                           sjmp  procura_codigo_lido
   79                          	;-------------------------------------------------------------------------------------
   80   0070   75 90 F0        	solta_tecla:               mov   P1,#F0h
   81   0073   E5 90           	st:                        mov   A,P1
   82   0075   B4 F0 FB        	                           cjne  A,#F0h,st
   83   0078   22              	                           ret
   84                          	;-------------------------------------------------------------------------------------
   85   0079   7E BE DE EE     	codigo_tec:                db    7Eh,BEh,DEh,EEh
   86   007D   7D BD DD ED     	                           db    7Dh,BDh,DDh,EDh
   87   0081   7B BB DB EB     	                           db    7Bh,BBh,DBh,EBh
   88   0085   77 B7 D7 E7 00  	                           db    77h,B7h,D7h,E7h,0
   89                          	;-------------------------------------------------------------------------------------
   90   008A   0A 39 38 37     	funcoes_tec:               db    0Ah,'9','8','7'
   91   008E   0B 36 35 34     	                           db    0Bh,'6','5','4'
   92   0092   0C 33 32 31     	                           db    0Ch,'3','2','1'
   93   0096   0D 0E 30 0F     	                           db    0Dh,0Eh,'0',0Fh
   94                          	
   95                          	
   96                          	
   97   009A                   	         
   98   009A                   	         END



           Lines Assembled :  98             Assembly Errors :  0


